import telebot
from datetime import date, time
import datetime

# Замените на токен вашего бота
TOKEN = '8058652594:AAHF2FI4zm9T9dvmR4Z2CQ-mbfVRkdHpVSs'
bot = telebot.TeleBot(TOKEN)

# 1. Полное расписание на день (0=понедельник, ..., 6=воскресенье)
WEEK_INFO = {
    0: "Понедельник:\n"
        "1. Английский язык (каб. 40) — 8:15–8:55\n"
        "2. Биология (каб. 23) — 9:00–9:40\n"
        "3. Физика (каб. 31) — 9:50–10:30\n"
        "4. РОВ (каб. 38) — 10:45–11:25\n"
        "5. Литература (каб. 31) — 11:40–12:20\n"
        "6. Алгебра (каб. 35) — 12:35–13:15\n"
        "7. Физическая культура — 13:25–14:05\n"
        "8. Английский язык (каб. 25) — 14:15–14:55",

    1: "Вторник:\n"
        "1. История (каб. 38) — 8:15–8:55\n"
        "2. Химия (каб. 41) — 9:00–9:40\n"
        "3. Геометрия (каб. 35) — 9:50–10:30\n"
        "4. Литература (каб. 27) — 10:45–11:25\n"
        "5. Английский язык (каб. 40/25) — 11:40–12:20\n"
        "6. Вероятность и статистика (каб. 35) — 12:35–13:15\n"
        "7. География (каб. 39) — 13:25–14:05\n"
        "8. ОБЗР (каб. 39) — 14:15–14:55",

    2: "Среда:\n"
        "1. Нет занятий — 8:15–8:55\n"
        "2. Обществознание (музей) — 9:00–9:40\n"
        "3. Физика (каб. 31) — 9:50–10:30\n"
        "4. Химия (каб. 41) — 10:45–11:25\n"
        "5. Информатика/Английский язык (каб. 22/40) — 11:40–12:20\n"
        "6. Физическая культура — 12:35–13:15\n"
        "7. Труд (технология, каб. 2) — 13:25–14:05\n"
        "8. История (музей) — 14:15–14:55",

    3: "Четверг:\n"
        "1. Физика (каб. 31) — 8:15–8:55\n"
        "2. Биология (каб. 23) — 9:00–9:40\n"
        "3. Информатика/Английский язык (каб. 22/25) — 9:50–10:30\n"
        "4. Русский язык (каб. 24) — 10:45–11:25\n"
        "5. Алгебра (каб. 35) — 11:40–12:20\n"
        "6. «Россия — мои горизонты» — 12:35–13:15",

    4: "Пятница:\n"
        "1. География (каб. 39) — 8:15–8:55\n"
        "2. Алгебра (каб. 35) — 9:00–9:40\n"
        "3. Русский язык (каб. 2) — 9:50–10:30\n"
        "4. Геометрия (каб. 35) — 10:45–11:25\n"
        "5. Русский язык (библиотека) — 11:40–12:20\n"
        "6. Литература (библиотека) — 12:35–13:15",

    5: "Суббота: время отдыха! Займитесь хобби или встретьтесь с друзьями.",
    6: "Воскресенье: подготовка к новой неделе! Отдохните и настройтесь на понедельник."
}

# 2. Расписание по интервалам (1=понедельник, ..., 7=воскресенье)
SCHEDULE = {
    1: [  # Понедельник
        (time(8, 15), time(8, 55), "Сейчас урок английского языка (каб. 40)"),
        (time(9, 0), time(9, 40), "Сейчас перемена"),
        (time(9, 50), time(10, 30), "Сейчас урок биологии (каб. 23)"),
        (time(10, 45), time(11, 25), "Сейчас перемена"),
        (time(11, 40), time(12, 20), "Сейчас урок физики (каб. 31)"),
        (time(12, 35), time(13, 15), "Сейчас перемена"),
        (time(13, 25), time(14, 5), "Сейчас урок РОВ (каб. 38)"),
        (time(14, 15), time(14, 55), "Сейчас перемена")
    ],
    2: [  # Вторник
        (time(8, 15), time(8, 55), "Сейчас урок истории (каб. 38)"),
        (time(9, 0), time(9, 40), "Сейчас перемена"),
        (time(9, 50), time(10, 30), "Сейчас урок химии (каб. 41)"),
        (time(10, 45), time(11, 25), "Сейчас перемена"),
        (time(11, 40), time(12, 20), "Сейчас урок геометрии (каб. 35)"),
        (time(12, 35), time(13, 15), "Сейчас перемена"),
        (time(13, 25), time(14, 5), "Сейчас урок литературы (каб. 27)"),
        (time(14, 15), time(14, 55), "Сейчас перемена")
    ],
    3: [  # Среда
        (time(8, 15), time(8, 55), "Сейчас нет занятий"),
        (time(9, 0), time(9, 40), "Сейчас перемена"),
        (time(9, 50), time(10, 30), "Сейчас урок обществознания (музей)"),
        (time(10, 45), time(11, 25), "Сейчас перемена"),
        (time(11, 40), time(12, 20), "Сейчас урок физики (каб. 31)"),
        (time(12, 35), time(13, 15), "Сейчас перемена"),
        (time(13, 25), time(14, 5), "Сейчас урок химии (каб. 41)"),
        (time(14, 15), time(14, 55), "Сейчас перемена")
    ],
    4: [  # Четверг
        (time(8, 15), time(8, 55), "Сейчас урок физики (каб. 31)"),
        (time(9, 0), time(9, 40), "Сейчас перемена"),
        (time(9, 50), time(10, 30), "Сейчас урок биологии (каб. 23)"),
        (time(10, 45), time(11, 25), "Сейчас перемена"),
        (time(11, 40), time(12, 20), "Сейчас урок информатики/английского (каб. 22/25)"),
        (time(12, 35), time(13, 15), "Сейчас перемена"),
        (time(13, 25), time(14, 5), "Сейчас урок русского языка (каб. 24)"),
        (time(14, 15), time(14, 55), "Сейчас перемена")
    ],
    5: [  # Пятница
        (time(8, 15), time(8, 55), "Сейчас урок географии (каб. 39)"),
        (time(9, 0), time(9, 40), "Сейчас перемена"),
        (time(9, 50), time(10, 30), "Сейчас урок алгебры (каб. 35)"),
        (time(10, 45), time(11, 25), "Сейчас перемена"),
        (time(11, 40), time(12, 20), "Сейчас урок русского языка (каб. 2)"),
        (time(12, 35), time(13, 15), "Сейчас перемена"),
        (time(13, 25), time(14, 5), "Сейчас урок геометрии (каб. 35)"),
        (time(14, 15), time(14, 55), "Сейчас перемена")
    ],
    6: [],  # Суббота — нет уроков
    7: []   # Воскресенье — выходной
}

def get_weekday() -> int:
    """Возвращает номер дня недели: 0=понедельник, 6=воскресенье."""
    return date.today().weekday()


def get_isoweekday() -> int:
    """Возвращает номер дня недели: 1=понедельник, 7=воскресенье."""
    return date.today().isoweekday()

@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.reply_to(message, (
        "Привет! Я бот расписания.\n"
        "Команды:\n"
        "/today — расписание на сегодня\n"
        "/что сейчас — что идёт прямо сейчас\n"
        "/понедельник … /воскресенье — расписание на конкретный день"
    ))

@bot.message_handler(commands=['today'])
def send_today_info(message):
    today_idx = get_weekday()
    info = WEEK_INFO[today_idx]
    bot.send_message(message.chat.id, info)

@bot.message_handler(commands=['сейчас'])
def send_current_info(message):
    now = datetime.datetime.now().time()
    day_idx = get_isoweekday()  # 1–7

    if day_idx == 7:
        response = "Сегодня воскресенье — занятий нет."
    else:
        schedule = SCHEDULE.get(day_idx, [])
        response = "Нет занятий"


        for start, end, text in schedule:
            if start <= now <= end:
                response = text
                break

    bot.send_message(message.chat.id, response)

# Команды для конкретных дней недели
@bot.message_handler(commands=['понедельник'])
def send_monday(message):
    bot.send_message(message.chat.id, WEEK_INFO[0])


@bot.message_handler(commands=['вторник'])
def send_tuesday(message):
    bot.send_message(message.chat.id, WEEK_INFO[1])

@bot.message_handler(commands=['среда'])
def send_wednesday(message):
    bot.send_message(message.chat.id, WEEK_INFO[2])


@bot.message_handler(commands=['четверг'])
def send_thursday(message):
    bot.send_message(message.chat.id, WEEK_INFO[3])

@bot.message_handler(commands=['пятница'])
def send_friday(message):
    bot.send_message(message.chat.id, WEEK_INFO[4])

@bot.message_handler(commands=['суббота'])
def send_saturday(message):
    bot.send_message(message.chat.id, WEEK_INFO[5])

@bot.message_handler(commands=['воскресенье'])
def send_sunday(message):
    bot.send_message(message.chat.id, WEEK_INFO[6])

# Запуск бота
if __name__ == '__main__':
    print("Бот запущен...")
    bot.polling(none_stop=True)
